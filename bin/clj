#!/bin/sh

## look upwards for a pom.xml

while [ ! `pwd` = "/" -a !  -f ./pom.xml ]
do
    cd ..
    echo "checking `pwd`..."
done

## did we find one ?

if [ ! -f "./pom.xml" ]
then
    echo "could not locate pom.xml"
    exit 1
fi

## yes...

file=.clojure-classpath.txt

if [ pom.xml -nt $file ]
then
    rm -f $file
fi

if [ ! -f $file ]
then
    mvn dependency:build-classpath -Dmdep.outputFile=$file
fi

CLASSPATH=\
src/test/java:\
src/main/java:\
src/main/resources:\
target/classes:\
`cat $file`

echo $CLASSPATH | tr : \\n

#exec java -cp $CLASSPATH clojure.main
#exec java -cp $CLASSPATH jline.ConsoleRunner clojure.lang.Repl
exec java -cp $CLASSPATH jline.ConsoleRunner clojure.main
